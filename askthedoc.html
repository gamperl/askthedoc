<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8"/>
		<meta name="application-name" content="AskTheDoc"/>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
		<title>AskTheDoc</title>
		<style>
			body {
			    background-color: #010c28;
			    color: #E8EFFF;
			    font-family: 'Noto Sans', Verdana, sans-serif;
			    font-size: 16px;
			}
			.content {
				display: flex;
				flex-direction: column;
			}
			.block {
				width: 100%;
				line-height: 1.5rem;
			}
			.block > div {
				flex: 1;
				border-radius: 20px;
				background-color: #201f37;
				padding: 16px;
				margin: 0.5rem 1rem 1.5rem 1.5rem;
				max-width: 48rem;
				margin-left: auto;
				margin-right: auto;
				border-width: 1px;
			}
			.block > div > div {
				display: inline-block;
				width: calc(100% - 55px);
			}
			.block > div::before {
				margin-right: 1rem;
				vertical-align: top;
			}

			.block input,
			.block button {
				border-width: 0;
				border-radius: 10px;
				padding-left: 20px;
				padding-right: 20px;
				height: 40px;
			    color: #E8EFFF;
			    background-color: #010c28;
				-webkit-appearance: none; /* to prevent Safari from ignoring font-size */
				-webkit-tap-highlight-color: transparent; /* Otherwise, tapping will show a flash of grey background on iOS Safari; see https://twitter.com/masa_kudamatsu/status/1429387005658468356 */
			}
			.block input {
				width: calc(100% - 105px);
			}
			.block input:focus {
				outline: 1px solid #c28cb9; /* fallback for forced color modes; see https://www.sarasoueidan.com/blog/focus-indicators/#tips-for-styling-focus-indicators */
				/* it also removes the default focus ring imposed by browsers */
			}
			.block input::placeholder {
				color: rgb(148, 148, 148);
				opacity: 1; /* to override the default of Firefox */
			}
			.block input::-webkit-search-decoration {
				-webkit-appearance: none; /* Remove the left padding inside the box for Safari; see https://github.com/filipelinhares/ress/blob/master/ress.css */
			}
			.block input::-webkit-search-cancel-button {
				-webkit-appearance: none; /* Remove default */
			}

			.settings.regular > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"48\" width=\"32\" viewBox=\"0 0 160 160\" xmlns=\"http://www.w3.org/2000/svg\">  <g transform=\"matrix(1.0134479999542236, 0, 0, 1.0134479999542236, -2435.491943359375, -1047.81884765625)\">  <path style=\"fill: rgb(194 140 185)\" d=\"M2488.9006348,1054.3352051   c6.4040527,5.7756348,8.8164062,14.7755127,6.159668,22.9799805l-5.432373,16.7751465   c-3.2304688,9.9760742-5.6503906,10.7648926-14.1398926,4.6098633l-14.2290039-10.3166504   c-6.9731445-5.0556641-10.329834-13.7333984-8.5739746-22.1655273l4.5449219-21.8260498   c2.4289551-11.6655273,6.3056641-12.932373,15.1542969-4.9520264L2488.9006348,1054.3352051z M2552.9467773,1075.3902588   c4.8554688-10.8817139,2.4526367-14.177124-9.3925781-12.8824463l-22.1621094,2.4222412   c-8.5622559,0.935791-15.777832,6.8096924-18.4313965,15.0039062l-5.4145508,16.7205811   c-3.2304688,9.9759521-1.7324219,12.0249023,8.7536621,12.0146484h17.6328125   c8.6240234-0.0085449,16.4377441-5.0926514,19.9519043-12.9682617L2552.9467773,1075.3902588z M2543.651123,1163.1190186   c11.8496094,1.2550049,14.2412109-2.0483398,9.3496094-12.9138184l-9.1523438-20.3289795   c-3.5356445-7.8538818-11.3518066-12.9012451-19.9650879-12.8927002l-17.5754395,0.017334   c-10.4858398,0.010376-11.9799805,2.0710449-8.7297363,12.0405273l5.465332,16.7645264   c2.6730957,8.1992188,9.9147949,14.0622559,18.4907227,14.9705811L2543.651123,1163.1190186z M2457.34375,1181.3879395   c2.4680176,11.6574707,6.348877,12.9112549,15.1708984,4.9013672l16.5058594-14.9862061   c6.376709-5.7897949,8.7617188-14.7830811,6.092041-22.9720459l-5.4475098-16.7098389   c-3.2502441-9.9696045-5.6716309-10.7537842-14.1489258-4.5819092l-14.255127,10.378418   c-6.9719238,5.0759277-10.3103027,13.7749023-8.5239258,22.2119141L2457.34375,1181.3879395z M2413.2983398,1104.9501953   c-10.3239746,5.949585-10.3171387,10.027832,0.0266113,15.9429932l19.3535156,11.0668945   c7.4768066,4.2756348,16.7670898,3.7647705,23.7302246-1.3046875l14.2084961-10.3446045   c8.4772949-6.171875,8.4748535-8.7172852-0.0146484-14.8724365l-14.2753906-10.3502197   c-6.9819336-5.0621338-16.2868652-5.5489502-23.7587891-1.2429199L2413.2983398,1104.9501953z\"/></g></svg>");
			}
			.settings.loading > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"48\" width=\"32\" viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"><path style=\"fill: rgb(194 140 185)\" d=\"M20.27,4.74a4.93,4.93,0,0,1,1.52,4.61,5.32,5.32,0,0,1-4.1,4.51,5.12,5.12,0,0,1-5.2-1.5,5.53,5.53,0,0,0,6.13-1.48A5.66,5.66,0,0,0,20.27,4.74ZM12.32,11.53a5.49,5.49,0,0,0-1.47-6.2A5.57,5.57,0,0,0,4.71,3.72,5.17,5.17,0,0,1,9.53,2.2,5.52,5.52,0,0,1,13.9,6.45,5.28,5.28,0,0,1,12.32,11.53ZM19.2,20.29a4.92,4.92,0,0,1-4.72,1.49,5.32,5.32,0,0,1-4.34-4.05A5.2,5.2,0,0,1,11.6,12.5a5.6,5.6,0,0,0,1.51,6.13A5.63,5.63,0,0,0,19.2,20.29ZM3.79,19.38A5.18,5.18,0,0,1,2.32,14a5.3,5.3,0,0,1,4.59-4,5,5,0,0,1,4.58,1.61,5.55,5.55,0,0,0-6.32,1.69A5.46,5.46,0,0,0,3.79,19.38ZM12.23,12a5.11,5.11,0,0,0,3.66-5,5.75,5.75,0,0,0-3.18-6,5,5,0,0,1,4.42,2.3,5.21,5.21,0,0,1,.24,5.92A5.4,5.4,0,0,1,12.23,12ZM11.76,12a5.18,5.18,0,0,0-3.68,5.09,5.58,5.58,0,0,0,3.19,5.79c-1,.35-2.9-.46-4-1.68A5.51,5.51,0,0,1,11.76,12ZM23,12.63a5.07,5.07,0,0,1-2.35,4.52,5.23,5.23,0,0,1-5.91.2,5.24,5.24,0,0,1-2.67-4.77,5.51,5.51,0,0,0,5.45,3.33A5.52,5.52,0,0,0,23,12.63ZM1,11.23a5,5,0,0,1,2.49-4.5,5.23,5.23,0,0,1,5.81-.06,5.3,5.3,0,0,1,2.61,4.74A5.56,5.56,0,0,0,6.56,8.06,5.71,5.71,0,0,0,1,11.23Z\"><animateTransform attributeName=\"transform\" type=\"rotate\" dur=\"1.5s\" values=\"0 12 12;360 12 12\" repeatCount=\"indefinite\"/></path></svg>");
			}
			.settings input,
			.settings button {
				margin-top: 10px;
			}

			.question.regular > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"48\" width=\"32\" viewBox=\"1698.517 1726.119 144.773 159.82\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"matrix(1.0886629819869995, 0, 0, 1.0886629819869995, -155.798095703125, -157.76962280273415)\"><path style=\"fill: rgb(194 140 185)\" d=\"M1748.4763184,1774.0247803   c0-11.4031982,9.27771-20.6809082,20.6807861-20.6809082c2.4433594,0,4.4248047,1.9815674,4.4248047,4.4249268   c0,2.4434814-1.9814453,4.4250488-4.4248047,4.4250488c-6.5239258,0-11.8309326,5.3068848-11.8309326,11.8309326   c0,2.4434814-1.9815674,4.4246826-4.4249268,4.4246826S1748.4763184,1776.4682617,1748.4763184,1774.0247803z    M1800.777832,1823.6722412c-2.3624268-0.9191895-5.0013428-0.8092041-7.2786865,0.3035889   c-7.3514404,3.5932617-15.6080322,5.6185303-24.3419189,5.6185303s-16.9904785-2.0252686-24.3419189-5.6185303   c-2.276123-1.1123047-4.9177246-1.2219238-7.2788086-0.3035889c-18.0174561,7.0070801-30.994873,21.0192871-34.0220947,43.1983643   c-0.3544922,2.5977783,0.4416504,5.2241211,2.166748,7.1983643c1.7249756,1.9741211,4.2175293,3.1083984,6.8391113,3.1083984   h113.2736816c2.6237793,0,5.1207275-1.1297607,6.8470459-3.1053467c1.7263184-1.9759521,2.5137939-4.6018066,2.1589355-7.201416   C1831.772583,1844.6915283,1818.7952881,1830.6793213,1800.777832,1823.6722412z M1725.7471924,1774.0247803   c0-23.9362793,19.4736328-43.4100342,43.4099121-43.4100342s43.4100342,19.4737549,43.4100342,43.4100342   c0,6.4663086-1.4315186,12.6014404-3.9779053,18.1204834l24.3453369,16.5560303   c3.2838135,2.2327881,4.135376,6.7044678,1.9016113,9.9882812c-1.3903809,2.0456543-3.6507568,3.1467285-5.9510498,3.1467285   c-1.3924561,0-2.7991943-0.402832-4.0372314-1.2452393l-24.3599854-16.565918   c-7.9072266,8.2546387-19.0247803,13.4102783-31.3308105,13.4102783   C1745.2208252,1817.4354248,1725.7471924,1797.9619141,1725.7471924,1774.0247803z M1739.0209961,1774.0247803   c0,16.6174316,13.5185547,30.1368408,30.1361084,30.1368408s30.1362305-13.5194092,30.1362305-30.1368408   c0-16.6175537-13.5186768-30.1362305-30.1362305-30.1362305S1739.0209961,1757.4072266,1739.0209961,1774.0247803z\"/></g></svg>");
			}
			.question.loading > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"48\" width=\"32\" viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\"><path style=\"fill: rgb(194 140 185)\" d=\"M20.27,4.74a4.93,4.93,0,0,1,1.52,4.61,5.32,5.32,0,0,1-4.1,4.51,5.12,5.12,0,0,1-5.2-1.5,5.53,5.53,0,0,0,6.13-1.48A5.66,5.66,0,0,0,20.27,4.74ZM12.32,11.53a5.49,5.49,0,0,0-1.47-6.2A5.57,5.57,0,0,0,4.71,3.72,5.17,5.17,0,0,1,9.53,2.2,5.52,5.52,0,0,1,13.9,6.45,5.28,5.28,0,0,1,12.32,11.53ZM19.2,20.29a4.92,4.92,0,0,1-4.72,1.49,5.32,5.32,0,0,1-4.34-4.05A5.2,5.2,0,0,1,11.6,12.5a5.6,5.6,0,0,0,1.51,6.13A5.63,5.63,0,0,0,19.2,20.29ZM3.79,19.38A5.18,5.18,0,0,1,2.32,14a5.3,5.3,0,0,1,4.59-4,5,5,0,0,1,4.58,1.61,5.55,5.55,0,0,0-6.32,1.69A5.46,5.46,0,0,0,3.79,19.38ZM12.23,12a5.11,5.11,0,0,0,3.66-5,5.75,5.75,0,0,0-3.18-6,5,5,0,0,1,4.42,2.3,5.21,5.21,0,0,1,.24,5.92A5.4,5.4,0,0,1,12.23,12ZM11.76,12a5.18,5.18,0,0,0-3.68,5.09,5.58,5.58,0,0,0,3.19,5.79c-1,.35-2.9-.46-4-1.68A5.51,5.51,0,0,1,11.76,12ZM23,12.63a5.07,5.07,0,0,1-2.35,4.52,5.23,5.23,0,0,1-5.91.2,5.24,5.24,0,0,1-2.67-4.77,5.51,5.51,0,0,0,5.45,3.33A5.52,5.52,0,0,0,23,12.63ZM1,11.23a5,5,0,0,1,2.49-4.5,5.23,5.23,0,0,1,5.81-.06,5.3,5.3,0,0,1,2.61,4.74A5.56,5.56,0,0,0,6.56,8.06,5.71,5.71,0,0,0,1,11.23Z\"><animateTransform attributeName=\"transform\" type=\"rotate\" dur=\"1.5s\" values=\"0 12 12;360 12 12\" repeatCount=\"indefinite\"/></path></svg>");
			}
			.question .icon {
				height: 30px;
				width: 30px;
				left: auto;
				right: 10px;
                float: right;
                padding: 9px;
    		}

			.source a {
				color: #E8EFFF;
				text-decoration: none;
			}
			.source a:hover .title {
				text-decoration: underline;
			}
			.source .summary {
				font-size: 12px;
			}
			.source > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"32\" viewBox=\"0 0 160 160\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"matrix(1.002506971359253, 0, 0, 1.002506971359253, -972.0570678710938, -689.7869873046875)\"><path style=\"fill: rgb(194 140 185)\" d=\"M1076.5656738,825.6894531   l-31.2492676-21.6885986c-1.9637451-1.3644409-1.8249512-3.3609009,0.3087158-4.4387817l32.2337646-16.2888794   c2.1333008-1.0778198,3.8116455-0.0062866,3.7299805,2.3828125l-1.3049316,38.168396   C1080.2022705,826.213501,1078.5292969,827.0537109,1076.5656738,825.6894531z M1086.2419434,771.8815918l22.112915-31.1347656   c1.3846436-1.9500122,0.5633545-3.6303711-1.824585-3.7385254l-38.0007324-1.7144775   c-2.3881836-0.1082153-3.4882812,1.5639038-2.4464111,3.715271l15.7475586,32.5053101   C1082.8725586,773.6660156,1084.8574219,773.8313599,1086.2419434,771.8815918z M1086.3320312,823.491333l25.913208-29.2039185   c1.5869141-1.7887573,1.0322266-3.8764648-1.2316895-4.6425781l-21.8817139-7.3921509   c-2.263916-0.7658691-4.1831055,0.5623169-4.2647705,2.951416l-1.2709961,37.194397   C1083.5142822,824.7877808,1084.7449951,825.2799072,1086.3320312,823.491333z M1033.762207,833.1282959l38.8569336-2.8814087   c2.3839111-0.1781616,2.7276611-1.4363403,0.763916-2.8005981l-30.3920898-21.090271   c-1.9637451-1.3644409-4.1959229-0.6259155-4.9606934,1.6380005l-7.2109375,21.3405762   C1030.0545654,831.5985107,1031.378418,833.3067017,1033.762207,833.1282959z M1083.3479004,706.397522l25.4080811,22.541626   c1.7875977,1.5849609,3.1051025,0.9335938,2.9281006-1.4491577l-0.6917725-9.3145752   c-0.177124-2.3827515-2.1749268-4.9584961-4.4396973-5.7224121l-22.3380127-7.5491943   C1081.949585,704.1401367,1081.5601807,704.812561,1083.3479004,706.397522z M1072.3666992,706.3636475l-7.2087402,21.338562   c-0.7647705,2.2639771,0.5622559,4.2033081,2.9503174,4.3115234l36.9558105,1.6655884   c2.3880615,0.1081543,2.8781738-1.1035156,1.0906982-2.6882935l-29.1467285-25.8601685   C1075.2205811,703.5458984,1073.1314697,704.0997314,1072.3666992,706.3636475z M1078.545166,699.5507812l18.3554688,6.2016602   c2.2650146,0.763916,2.4899902,0.3057251,0.5006104-1.0205078l-16.9273682-11.2792358   c-1.6813965-1.1202393-3.5858154-0.4710693-4.2316895,1.4428711   C1075.5948486,696.8092651,1076.6314697,698.9035034,1078.545166,699.5507812z M1039.6915283,792.8953857l6.901001-20.4282227   c0.7648926-2.2639771-0.4614258-4.7421265-2.7253418-5.5081787l-19.9498291-6.7407837   c-2.263916-0.7658691-3.2633667,0.3669434-2.2215576,2.5185547l14.7102051,30.364624   C1037.4477539,795.2527466,1038.9267578,795.1593018,1039.6915283,792.8953857z M1057.3201904,740.717041   c0.7647705-2.263916-0.3543701-3.2335815-2.4876709-2.1557007l-30.1099854,15.2172241   c-2.1335449,1.0778809-2.0262451,2.5866089,0.2375488,3.352478l19.9510498,6.7387695   c2.263916,0.7658691,4.7420654-0.4603882,5.506958-2.7243042L1057.3201904,740.717041z M1045.2663574,796.0907593   l30.1099854-15.2172852c2.1335449-1.0778809,2.0264893-2.5863647-0.2385254-3.3502808l-19.9489746-6.7407227   c-2.2648926-0.763916-4.7431641,0.4625244-5.5080566,2.7265015l-6.9020996,20.4262695   C1042.013916,796.1991577,1043.1330566,797.1686401,1045.2663574,796.0907593z M1015.2340088,749.4481812l1.2699585-37.2115479   c0.081665-2.3890991-1.1491699-2.8814087-2.7349854-1.0926514l-25.9172974,29.2230225   c-1.5860596,1.7866211-1.0313721,3.8765259,1.2336426,4.6402588l21.8828125,7.3942871   C1013.2331543,753.1654663,1015.1523438,751.8372803,1015.2340088,749.4481812z M1019.8127441,710.8278809l-1.3016968,38.168396   c-0.081665,2.3890991,1.5964966,3.4604492,3.7301025,2.3825684l32.2337036-16.2907715   c2.1335449-1.0778809,2.2724609-3.0743408,0.3087158-4.4387817l-31.2525024-21.6864624   C1021.5673828,707.5985718,1019.8944092,708.4387817,1019.8127441,710.8278809z M1115.1849365,730.5962524   c0.177002,2.3828125,1.7844238,5.6311646,3.5718994,7.2183228l4.0843506,3.6259766   c1.7877197,1.5871582,2.3817139,1.1330566,1.3208008-1.0076904l-7.7740479-15.692627   c-1.0609131-2.1407471-1.7833252-1.9434814-1.6060791,0.43927L1115.1849365,730.5962524z M993.5675659,797.6481323   l38.0028687,1.7103271c2.3879395,0.1082153,3.4882812-1.5639038,2.4464111-3.715271l-15.7486572-32.5053101   c-1.0418091-2.1516113-3.0267944-2.3171997-4.4112549-0.3671875l-22.1140137,31.138916   C990.3585205,795.8595581,991.1795654,797.539917,993.5675659,797.6481323z M1066.3355713,701.5239868l-38.8569336,2.8812256   c-2.383667,0.1783447-2.727417,1.4365234-0.7636719,2.8007812l30.394043,21.090271   c1.9637451,1.3644409,4.1959229,0.6259155,4.9606934-1.6380005l7.2087402-21.3407593   C1070.0432129,703.053772,1068.7194824,701.3455811,1066.3355713,701.5239868z M1078.4041748,771.9176636l-14.7102051-30.364563   c-1.041748-2.1516113-2.520752-2.0581665-3.2855225,0.2057495l-6.9031982,20.4304199   c-0.7647705,2.263916,0.4614258,4.7421265,2.7253418,5.5081787l19.9509277,6.7385864   C1078.4465332,775.2021484,1079.4459229,774.0690918,1078.4041748,771.9176636z M1050.1306152,689.949646l18.368042,6.2062988   c1.9139404,0.6470337,4.0090332-0.3904419,4.6563721-2.3043823c0.645874-1.9138794-0.4743652-3.5857544-2.4899902-3.715271   l-20.3148193-1.2984009C1047.9642334,688.6851807,1047.8656006,689.18573,1050.1306152,689.949646z M1110.1245117,743.8870239   l-21.5506592,30.3432617c-1.3846436,1.9500122-0.6641846,4.1693726,1.6008301,4.9352417l21.8796387,7.392334   c2.2650146,0.7637329,3.9729004-0.5603027,3.7958984-2.9428711l-2.8876953-38.9386597   C1112.7851562,742.2935791,1111.5089111,741.9370117,1110.1245117,743.8870239z M1021.5526123,835.1036987l-18.3724365-6.2060547   c-2.263916-0.7661133-2.4888306-0.3076782-0.4995117,1.0161743l16.9432373,11.2877197   c1.6803589,1.1204834,3.5858154,0.4710693,4.2328491-1.442627   C1024.5029297,837.8449707,1023.4663086,835.7509766,1021.5526123,835.1036987z M1073.4445801,833.4528809l-33.8719482,2.5144653   c-2.383667,0.1759644-2.4814453,0.946228-0.2164307,1.7120972l22.3359375,7.5450439   c2.263916,0.7658691,5.4146729-0.0699463,7.0007324-1.8587036l6.2009277-6.982605   C1076.4798584,834.5944214,1075.8282471,833.2769165,1073.4445801,833.4528809z M1049.9545898,844.7004395l-18.3565674-6.2019043   c-1.9125977-0.6472778-4.0079346,0.3904419-4.6540527,2.3041382c-0.6470947,1.9117432,0.4720459,3.5838013,2.487915,3.7130737   l20.302002,1.298645C1052.1196289,845.9671021,1052.2182617,845.4663086,1049.9545898,844.7004395z M1027.7310791,828.2908325   l7.2109375-21.3407593c0.7647705-2.2639771-0.5622559-4.2033081-2.9503174-4.3115234l-36.9154053-1.6633911   c-2.3882446-0.1082153-2.8792725,1.1032715-1.0928955,2.6904297l29.1085815,25.855835   C1024.87854,831.1083374,1026.9663086,830.5547485,1027.7310791,828.2908325z M1092.2242432,832.0547485l-5.4465332,0.4074097   c-2.3839111,0.1759644-5.6312256,1.7844238-7.2182617,3.572998l-3.6047363,4.0611572   c-1.5871582,1.7885742-1.131958,2.3825684,1.0109863,1.3238525l15.6967773-7.7612915   C1094.8052979,832.6000977,1094.6080322,831.8786011,1092.2242432,832.0547485z M1127.4221191,767.4237061l-6.2008057,18.3533325   c-0.6459961,1.9136963,0.3903809,4.0079346,2.3032227,4.6551514c1.9128418,0.6470337,3.5836182-0.4732056,3.7131348-2.4890137   l1.2983398-20.2987061C1128.6877441,765.2594604,1128.1871338,765.159729,1127.4221191,767.4237061z M1110.9775391,800.6251221   l-22.5460205,25.4102173c-1.5860596,1.7885742-0.9335938,3.104126,1.4503174,2.9279175l9.3166504-0.6959229   c2.3839111-0.1759644,4.9595947-2.1748657,5.7246094-4.4387817l7.5469971-22.3378296   C1113.2348633,799.2268066,1112.5635986,798.8363647,1110.9775391,800.6251221z M1116.1748047,743.9293823l2.5141602,33.8719482   c0.177124,2.3827515,0.9473877,2.4803467,1.7122803,0.2163696l7.5449219-22.3314819   c0.7650146-2.2639771-0.0710449-5.4147949-1.8585205-7.0019531l-6.9849854-6.2019043   C1117.3151855,740.8952026,1115.9974365,741.546814,1116.1748047,743.9293823z M1122.4816895,793.5194092   c-1.9139404-0.6472778-4.0090332,0.3901978-4.6552734,2.3040771l-6.2008057,18.3511963   c-0.7647705,2.263916-0.3065186,2.4887695,1.0196533,0.5007935l11.2792969-16.9232788   C1125.0447998,796.0697021,1124.3956299,794.1663818,1122.4816895,793.5194092z M1007.8566284,702.605957l5.4486694-0.4030151   c2.3839111-0.1762085,5.630127-1.7844238,7.2161865-3.5731812l3.6153564-4.0800781   c1.5860596-1.7885742,1.1300049-2.3849487-1.012085-1.3262329l-15.7073975,7.7762451   C1005.2755127,702.0584717,1005.4727783,702.7821655,1007.8566284,702.605957z M989.1213989,734.0249634l22.5183716-25.3932495   c1.5860596-1.7885742,0.9335938-3.1060791-1.4503174-2.9301147l-9.2890625,0.687439   c-2.3839111,0.1762085-4.9595947,2.1727295-5.7243652,4.4366455l-7.5473022,22.3336792   C986.8639526,735.4232788,987.5355225,735.8137207,989.1213989,734.0249634z M972.6767578,767.2305298l6.2008667-18.3530884   c0.6461182-1.9139404-0.3904419-4.0079346-2.3032837-4.6552124c-1.9125977-0.6472168-3.5836182,0.4732056-3.7131348,2.4888306   l-1.2984009,20.2989502C971.4111938,769.3947754,971.9117432,769.4945068,972.6767578,767.2305298z M977.6172485,741.1329346   c1.9138794,0.6472168,4.0079346-0.3904419,4.6541138-2.302002l6.2008057-18.3511353   c0.7650146-2.263916,0.3065796-2.4888306-1.0183105-0.5007935l-11.27948,16.9232178   C975.0551758,738.5825806,975.7033081,740.4859009,977.6172485,741.1329346z M1016.7498779,828.2547607l-25.413208-22.5459595   c-1.7877197-1.5849609-3.1074219-0.9335938-2.932251,1.451355l0.6852417,9.3101807   c0.1749268,2.3827515,2.1705322,4.9586792,4.4355469,5.7224121l22.3579712,7.5557251   C1018.1482544,830.512146,1018.5375977,829.8394775,1016.7498779,828.2547607z M1026.6501465,701.201355l33.875-2.5142212   c2.3839111-0.1762085,2.4814453-0.9464722,0.2175293-1.7123413l-22.3571777-7.5535278   c-2.2636719-0.7658691-5.4125977,0.0721436-6.9975586,1.8609009l-6.1901855,6.9869385   C1023.6127319,700.0578613,1024.2662354,701.3775635,1026.6501465,701.201355z M989.96698,790.7800903l21.5591431-30.3561401   c1.3843994-1.9497681,0.6641846-4.1691284-1.6008301-4.9352417l-21.883728-7.3921509   c-2.2639771-0.7658691-3.9721069,0.5579834-3.7958984,2.9407349l2.8844604,38.9534302   C987.3063354,792.3735352,988.5825806,792.7300415,989.96698,790.7800903z M983.9145508,790.6972656l-2.5068359-33.8463135   c-0.1760254-2.3827515-0.946228-2.4802856-1.7112427-0.2163696l-7.5459595,22.3336792   c-0.7649536,2.263916,0.0721436,5.4125977,1.8607178,6.9997559l6.972168,6.1784668   C982.7721558,793.7335815,984.0907593,793.0800781,983.9145508,790.6972656z M984.9076538,804.034729   c-0.1762085-2.3827515-1.7822266-5.6311646-3.5699463-7.2161255l-4.0917969-3.6281738   c-1.7874756-1.5849609-2.3827515-1.1308594-1.322937,1.0120239l7.7751465,15.7095947   c1.0598755,2.1429443,1.7844238,1.9456787,1.6084595-0.4371338L984.9076538,804.034729z\"/></g></svg>");
			}

			.answer .content {
				white-space: pre-wrap;
			}
			.answer > div::before {
				content: url("data:image/svg+xml; utf8, <svg height=\"32\" viewBox=\"1698.517 1726.119 144.773 159.82\" xmlns=\"http://www.w3.org/2000/svg\"><g transform=\"matrix(0.8618299961090088, 0, 0, 0.8618299961090088, 556.7683715820312, 247.03187561035156)\"><path style=\"fill: rgb(194 140 185)\" d=\"M1414.4926758,1803.270874   c3.1679688,3.1669922,3.1679688,8.3237305,0,11.4919434c-1.5338135,1.5335693-3.5753174,2.3768311-5.7459717,2.3768311   c-2.1710205,0-4.2099609-0.8432617-5.7459717-2.3768311c-3.1707764-3.1707764-3.1707764-8.3287354-0.0025635-11.4969482   C1406.064209,1800.2001953,1411.4240723,1800.2001953,1414.4926758,1803.270874z M1360.7598877,1849.5426025   c-2.0522461,2.0551758-2.0522461,5.3983154,0.005127,7.4560547c0.994751,0.9946289,2.3186035,1.543335,3.7266846,1.543335   c1.4064941,0,2.729248-0.5487061,3.7264404-1.543335c2.0526123-2.0551758,2.0526123-5.3983154,0-7.4509277   C1366.2236328,1847.5541992,1362.7496338,1847.5480957,1360.7598877,1849.5426025z M1347.5671387,1864.1755371   c-1.6557617,1.6595459-1.6557617,4.3591309,0,6.0196533c0.8061523,0.803833,1.8747559,1.2474365,3.0101318,1.2474365   c1.1379395,0,2.2078857-0.4436035,3.0092773-1.2474365c0.8063965-0.803833,1.2476807-1.8737793,1.2476807-3.0091553   c0-1.1379395-0.4438477-2.2091064-1.2476807-3.010498   C1351.9790039,1862.5681152,1349.1768799,1862.5643311,1347.5671387,1864.1755371z M1449.2774658,1849.5426025   c-2.0550537,2.0577393-2.0576172,5.4008789-0.0025635,7.4560547c0.9937744,0.9946289,2.3151855,1.543335,3.7230225,1.543335   c1.411499,0,2.7329102-0.5487061,3.7304688-1.5458984c2.057373-2.0551758,2.057373-5.3983154,0-7.4534912   C1454.7386475,1847.5529785,1451.2694092,1847.5529785,1449.2774658,1849.5426025z M1463.9053955,1864.1719971   c-1.6580811,1.657959-1.6555176,4.3588867,0.0024414,6.0194092c0.8039551,0.803833,1.8725586,1.24646,3.0079346,1.24646   s2.206665-0.442627,3.010498-1.24646c0.803833-0.8010254,1.2462158-1.8725586,1.2462158-3.0101318   c0-1.135376-0.4449463-2.2043457-1.2462158-3.0079346   C1468.3187256,1862.5681152,1465.5178223,1862.5620117,1463.9053955,1864.1719971z M1430.1339111,1778.4862061   c-2.517334,2.5196533-2.5198975,6.6187744-0.0025635,9.1384277c1.220459,1.2191162,2.8428955,1.8922119,4.5710449,1.8922119   c1.7271729,0,3.3520508-0.6730957,4.5725098-1.8922119c1.220459-1.220459,1.8922119-2.8426514,1.8896484-4.5710449   c-0.0012207-1.7246094-0.6743164-3.3482666-1.8947754-4.5673828   C1436.8302002,1776.0452881,1432.5736084,1776.0452881,1430.1339111,1778.4862061z M1430.1339111,1830.4041748   c-1.2191162,1.2191162-1.8922119,2.84021-1.8922119,4.5661621c-0.0025635,1.7269287,0.6705322,3.3504639,1.8922119,4.5697021   c1.220459,1.220459,2.840332,1.8947754,4.5710449,1.8947754c1.7246094,0,3.3494873-0.671875,4.5699463-1.8922119   c1.220459-1.220459,1.8922119-2.8428955,1.8896484-4.5699463c-0.0012207-1.7259521-0.6743164-3.3493652-1.8947754-4.5684814   C1436.8302002,1827.9594727,1432.5736084,1827.9594727,1430.1339111,1830.4041748z M1389.2491455,1834.9703369   c-0.0025635-1.7259521-0.6743164-3.3482666-1.8947754-4.5687256c-2.4395752-2.4395752-6.6987305-2.4395752-9.1358643,0   c-2.5211182,2.5196533-2.5211182,6.6187744,0,9.1384277c1.2192383,1.220459,2.8427734,1.8922119,4.5697021,1.8922119   c1.7283936,0,3.3508301-0.6717529,4.571167-1.8922119   C1388.5786133,1838.3208008,1389.251709,1836.6972656,1389.2491455,1834.9703369z M1378.2159424,1787.6246338   c1.220459,1.2191162,2.8428955,1.8922119,4.5699463,1.8922119c1.7281494,0,3.3505859-0.6730957,4.5710449-1.8922119   c1.220459-1.220459,1.8922119-2.8426514,1.8896484-4.5684814c0-1.7271729-0.6717529-3.3508301-1.8922119-4.5699463   c-2.4395752-2.440918-6.6962891-2.440918-9.1358643,0   C1375.6973877,1781.0058594,1375.6973877,1785.1049805,1378.2159424,1787.6246338z M1453.0064697,1770.0281982   c1.4067383,0,2.7294922-0.5473633,3.7219238-1.5421143c2.057373-2.0550537,2.0548096-5.3995361-0.0025635-7.4559326   c-1.9897461-1.9907227-5.4598389-1.9907227-7.4509277,0c-0.9971924,0.9949951-1.5445557,2.3189697-1.5445557,3.7266846   c0,1.4064941,0.5473633,2.7294922,1.5445557,3.7242432   C1450.2722168,1769.4782715,1451.5974121,1770.0281982,1453.0064697,1770.0281982z M1466.9110107,1755.0993652   c1.135376,0,2.2041016-0.4438477,3.0101318-1.2474365c0.8039551-0.8026123,1.24646-1.8699951,1.24646-3.0067139   c0.0048828-1.1378174-0.4400635-2.2067871-1.24646-3.0129395c-1.6048584-1.6074219-4.4093018-1.6049805-6.0157471,0.0025635   c-0.8049316,0.8035889-1.2462158,1.8725586-1.2487793,3.010376c0,1.1367188,0.4438477,2.2053223,1.2474365,3.0067139   C1464.7080078,1754.6555176,1465.7756348,1755.0993652,1466.9110107,1755.0993652z M1364.4866943,1770.0307617   c1.4064941,0,2.7293701-0.5499268,3.7266846-1.5446777c2.0550537-2.0576172,2.057373-5.4020996,0.0047607-7.4559326   c-1.9907227-1.9907227-5.463501-1.9907227-7.458252,0.0012207c-2.0522461,2.0551758-2.0522461,5.3996582,0,7.4547119   C1361.7574463,1769.480835,1363.0802002,1770.0307617,1364.4866943,1770.0307617z M1405.1641846,1776.8009033   c0.9577637,0.956665,2.2287598,1.484375,3.5799561,1.484375c1.3535156,0,2.6269531-0.52771,3.5822754-1.484375   c0.9569092-0.9553223,1.4842529-2.2287598,1.4842529-3.5847168c0-1.3535156-0.5250244-2.6247559-1.4816895-3.5800781   c-1.9106445-1.9144287-5.2503662-1.9144287-7.1671143,0   C1403.1879883,1771.6134033,1403.1879883,1774.8261719,1405.1641846,1776.8009033z M1449.6090088,1809.0144043   c0-1.3535156-0.52771-2.6269531-1.4842529-3.5848389c-1.9155273-1.9145508-5.2526855-1.9119873-7.1672363,0.0025635   c-1.9725342,1.9747314-1.9725342,5.1896973,0,7.1645508c0.9578857,0.9569092,2.2314453,1.4842529,3.5848389,1.4842529   c1.3513184,0,2.6221924-0.5273438,3.5800781-1.4842529   C1449.0791016,1811.6413574,1449.6066895,1810.3679199,1449.6090088,1809.0144043z M1376.5332031,1805.4321289   c-1.9169922-1.918335-5.2563477-1.9122314-7.1660156,0.0021973c-1.977417,1.9750977-1.9748535,5.1900635,0,7.1635742   c0.956543,0.9578857,2.2299805,1.4855957,3.5812988,1.4855957c1.3509521,0,2.6243896-0.52771,3.5822754-1.4855957   C1378.5054932,1810.6218262,1378.5068359,1807.4068604,1376.5332031,1805.4321289z M1405.1606445,1841.2303467   c-1.9726562,1.9772949-1.9726562,5.1884766,0,7.1610107c0.956543,0.9578857,2.2299805,1.487793,3.5834961,1.487793   s2.6221924-0.5275879,3.5800781-1.4852295c1.9772949-1.9763184,1.9772949-5.1912842,0.0021973-7.1661377   C1410.4157715,1839.3133545,1407.0750732,1839.3157959,1405.1606445,1841.2303467z M1347.5671387,1747.8372803   c-0.8063965,0.8011475-1.2490234,1.8725586-1.24646,3.0102539c0,1.1343994,0.4400635,2.2030029,1.24646,3.006958   c0.8010254,0.8035889,1.8699951,1.2474365,3.0101318,1.2474365c1.135376,0,2.2043457-0.4414062,3.0079346-1.2452393   c1.6583252-1.657959,1.6583252-4.3588867-0.0021973-6.0194092   C1351.970459,1746.2272949,1349.1695557,1746.2321777,1347.5671387,1747.8372803z M1384.4315186,1726.4942627   c-0.8035889,0.803833-1.244873,1.8725586-1.244873,3.0091553c0,1.135376,0.4436035,2.2043457,1.2474365,3.0079346   c0.803833,0.803833,1.8737793,1.24646,3.0091553,1.24646s2.2041016-0.4400635,3.0079346-1.2438965   c0.803833-0.8061523,1.2487793-1.8751221,1.2462158-3.0117188c-0.0009766-1.135376-0.4423828-2.2041016-1.2487793-3.0053711   C1388.8411865,1724.8867188,1386.0415039,1724.8842773,1384.4315186,1726.4942627z M1405.7387695,1743.2512207   c-1.6557617,1.6582031-1.6557617,4.3591309,0,6.0170898c0.8061523,0.803833,1.8748779,1.24646,3.010376,1.24646   c1.135376,0,2.2041016-0.4400635,3.0090332-1.2438965c0.8063965-0.8061523,1.2476807-1.8751221,1.2476807-3.0114746   c0-1.1356201-0.4464111-2.2043457-1.25-3.0056152C1410.1506348,1741.6414795,1407.3461914,1741.6436768,1405.7387695,1743.2512207z    M1468.6368408,1806.149292c-1.6582031,1.6583252-1.6568604,4.3592529,0.0023193,6.0172119   c0.803833,0.8063965,1.8737793,1.2489014,3.0091553,1.2489014c1.1379395,0,2.2043457-0.4425049,3.0079346-1.24646   c0.8039551-0.8061523,1.2490234-1.875,1.24646-3.0126953c-0.0012207-1.1356201-0.4425049-2.2017822-1.2486572-3.0056152   C1473.0474854,1804.5418701,1470.2469482,1804.5393066,1468.6368408,1806.149292z M1485.2493896,1827.3111572   c-0.8035889,0.8035889-1.244873,1.8725586-1.244873,3.010376c0,1.135376,0.4425049,2.2041016,1.2462158,3.0079346   c0.803833,0.8037109,1.8725586,1.2462158,3.010376,1.2462158c1.135376,0,2.2043457-0.4400635,3.0079346-1.2438965   c0.803833-0.8061523,1.2487793-1.8748779,1.24646-3.0126953c-0.0025635-1.135376-0.442627-2.2017822-1.2489014-3.0057373   C1489.6590576,1825.7023926,1486.8581543,1825.7047119,1485.2493896,1827.3111572z M1326.2218018,1784.7042236   c-0.8013916,0.8026123-1.2440186,1.8713379-1.2414551,3.0092773c0,1.135376,0.4400635,2.2039795,1.2462158,3.0079346   c0.8013916,0.803833,1.8699951,1.2460938,3.0079346,1.2460938c1.1378174,0,2.2055664-0.4422607,3.0067139-1.2460938   c1.6617432-1.6593018,1.6594238-4.3566895,0-6.0172119   C1330.6348877,1783.0968018,1327.8292236,1783.0968018,1326.2218018,1784.7042236z M1427.0396729,1885.520874   c-1.6569824,1.6569824-1.6569824,4.3566895,0.0047607,6.0172119c0.8013916,0.803833,1.8713379,1.2476807,3.0091553,1.2476807   c1.135376,0,2.2043457-0.4438477,3.0057373-1.2476807c1.6605225-1.6580811,1.657959-4.3590088,0-6.0172119   C1431.4515381,1883.9134521,1428.6470947,1883.9134521,1427.0396729,1885.520874z M1326.223999,1827.3133545   c-0.8035889,0.8013916-1.2486572,1.8703613-1.2486572,3.0057373c0,1.1378174,0.4412842,2.206543,1.24646,3.0126953   c0.8035889,0.803833,1.8712158,1.2438965,3.0065918,1.2438965l0,0c1.1379395,0,2.2078857-0.4425049,3.0117188-1.2462158   c0.8037109-0.803833,1.2462158-1.8725586,1.2487793-3.010376c0-1.135376-0.4438477-2.2043457-1.2476807-3.0079346   C1330.6348877,1825.7047119,1327.8292236,1825.7023926,1326.223999,1827.3133545z M1430.0476074,1733.7565918   c1.1378174,0,2.2053223-0.4438477,3.0117188-1.2474365c0.8035889-0.8039551,1.2462158-1.8703613,1.2462158-3.006958   c0-1.135376-0.4400635-2.206543-1.2462158-3.0102539c-1.6077881-1.6099854-4.4084473-1.607666-6.0170898,0.0023193   c-1.6595459,1.6607666-1.6595459,4.3591309-0.0025635,6.0170898   C1427.8409424,1733.3151855,1428.909668,1733.7565918,1430.0476074,1733.7565918z M1384.434082,1885.520874   c-0.8061523,0.8039551-1.2474365,1.8701172-1.2487793,3.0057373c-0.0024414,1.1375732,0.4400635,2.206543,1.2437744,3.0114746   c0.803833,0.803833,1.8702393,1.2451172,3.010376,1.2451172c1.135376,0,2.2043457-0.4412842,3.0091553-1.2451172   c0.8039551-0.8023682,1.2478027-1.8713379,1.2478027-3.0092773c0-1.135376-0.4414062-2.2039795-1.2452393-3.0079346   C1388.8411865,1883.9134521,1386.0428467,1883.909668,1384.434082,1885.520874z M1488.2563477,1791.965332   c1.1375732,0,2.2091064-0.442627,3.0102539-1.24646c0.8062744-0.8035889,1.2463379-1.8725586,1.2463379-3.010498   c0.0025635-1.1352539-0.4400635-2.2027588-1.2438965-3.0065918c-1.6099854-1.6099854-4.4108887-1.6075439-6.0183105,0.0024414   c-0.8037109,0.8013916-1.2462158,1.8675537-1.2487793,3.0041504c-0.0025635,1.1379395,0.4438477,2.2069092,1.2487793,3.0130615   C1486.0533447,1791.5252686,1487.1207275,1791.965332,1488.2563477,1791.965332z M1349.019043,1805.9902344   c-1.6074219-1.6062012-4.413208-1.6062012-6.0194092,0c-0.803833,0.8039551-1.2476807,1.8726807-1.2451172,3.010498   c0.0024414,1.135376,0.4425049,2.2043457,1.24646,3.0079346c0.8035889,0.803833,1.8725586,1.24646,3.0101318,1.24646   c1.135376,0,2.2043457-0.4412842,3.0079346-1.2438965   C1350.6772461,1810.3519287,1350.6772461,1807.6520996,1349.019043,1805.9902344z M1405.8988037,1868.8884277   c-1.6605225,1.6595459-1.657959,4.3591309,0,6.0184326c0.803833,0.803833,1.8725586,1.2463379,3.010498,1.2463379   c1.135376,0,2.2042236-0.4412842,3.0091553-1.2451172c0.803833-0.8049316,1.2476807-1.8739014,1.2476807-3.0117188   c-0.0024414-1.135376-0.4462891-2.2015381-1.2512207-3.0053711   C1410.307251,1867.2796631,1407.5065918,1867.2810059,1405.8988037,1868.8884277z\"/></g></svg>");
			}
		</style>

		<script type="module">
			let articleCache = null;
			let answerRunning = false;

			async function compressData(data) {
				const stream = new Blob([JSON.stringify(data)]).stream();
				const compressionStream = stream.pipeThrough(new CompressionStream('gzip'));
				const buffer = await new Response(compressionStream).arrayBuffer();
				return btoa([].reduce.call(new Uint8Array(buffer), (p, c) => p + String.fromCharCode(c), ''));
			}

			async function decompressData(base64) {
			    const binaryString = atob(base64);
			    const bytes = new Uint8Array(binaryString.length);
			    for (let i = 0; i < binaryString.length; i++) {
			        bytes[i] = binaryString.charCodeAt(i);
			    }
				const stream = new Blob([bytes]).stream();
				const decompressionStream = stream.pipeThrough(new DecompressionStream('gzip'));
				const buffer = await new Response(decompressionStream).arrayBuffer();
				return JSON.parse(new TextDecoder().decode(new Uint8Array(buffer)));
			}

			async function openIndexedDB() {
			    return new Promise((resolve, reject) => {
			        let request = indexedDB.open('askthedoc', 1);

			        request.onupgradeneeded = event => {
			            let db = event.target.result;
			            if (!db.objectStoreNames.contains('articles')) {
			                db.createObjectStore('articles', { autoIncrement: true });
			            }
			        };

			        request.onsuccess = event => {
			            let db = event.target.result;
			            resolve(db);
			        };

			        request.onerror = event => {
			            reject(event.target.errorCode);
			        };
			    });
			}

			async function saveArticles(articles) {
			    let db = await openIndexedDB();
			    return new Promise((resolve, reject) => {
			        let transaction = db.transaction('articles', 'readwrite');
			        let store = transaction.objectStore('articles');
			        articles.forEach(article => store.add(article));

			        transaction.oncomplete = () => resolve();
			        transaction.onerror = event => reject(event.target.errorCode);
			    });
			}

			async function loadArticles() {
				let db = await openIndexedDB();
			    return new Promise(async (resolve, reject) => {
			        let transaction = db.transaction('articles', 'readonly');
			        let store = transaction.objectStore('articles');
			        let allRecords = store.getAll();

			        allRecords.onsuccess = () => resolve(allRecords.result);
			        allRecords.onerror = event => reject(event.target.errorCode);
			    });
			}

			async function scrapeDoc() {
				document.getElementById('settings').classList.remove('regular');
				document.getElementById('settings').classList.add('loading');
				document.getElementById('scrape').style.display = 'none';

				const articleUrl = document.getElementById('zendeskArticleUri').value;
				const openAIAPIKey = document.getElementById('openAIAPIKey').value;

				if (!articleUrl || !openAIAPIKey) {
					console.log('missing input');
					return;
				}

				sessionStorage.setItem('zendeskArticleUri', articleUrl);
				sessionStorage.setItem('openAIAPIKey', openAIAPIKey);

				const articles = await scrapePage(document.getElementById('zendeskArticleUri').value);
				await addEmbeddings(articles, openAIAPIKey);
				// const compressed = await compressData(articles);
				// localStorage.setItem('articles', compressed);

				console.log(articles.length);

				await saveArticles(articles);
				articleCache = articles;

				document.getElementById('settings').style.display = 'none';
				document.getElementById('question').style.visibility = 'visible';

				console.log('done')
			}

			function element2Markdown(node, chunks) {
				node.childNodes.forEach(childNode => {
					if (childNode.nodeType === Node.TEXT_NODE) {
						chunks[0] += childNode.textContent;
					}
					if (['H1', 'H2'].includes(childNode.nodeName) && chunks[0].length > 512) {
						chunks.unshift('');
					}
					switch (childNode.nodeName) {
						case 'H1': chunks[0] += `# ${childNode.textContent}\n\n`; break;
						case 'H2': chunks[0] += `## ${childNode.textContent}\n\n`; break;
						case 'H3': chunks[0] += `### ${childNode.textContent}\n\n`; break;
						case 'li': chunks[0] += `- ${childNode.textContent}\n\n`; break;
						default: element2Markdown(childNode, chunks);
					}
				});
			}

			async function scrapePage(url) {
				const articles = [];
				console.log('scraping', url);

				const response = await fetch(url, { mode: 'cors' });
				const json = await response.json();

				if (typeof json !== "object" || json === null || !Array.isArray(json.articles)) {
					console.log('error loading articles');
					return;
				}

				// TODO: split articles into chunks of more than 500 characters
				json.articles
					.filter(article => typeof article.body === 'string' && article.body.length < 8000)
					.forEach(article => {
						const parser = new DOMParser();
						const doc = parser.parseFromString(article.body, 'text/html');
						const chunks = [''];
						doc.body.childNodes.forEach(node => element2Markdown(node, chunks));
						chunks.map(chunk => {
							articles.push({
								id: article.id,
								title: article.title,
								body: chunk.trim(),
								url: article.html_url
							})
						})
					});

				if (typeof json.next_page === 'string') {
					articles.push(...await scrapePage(json.next_page));
				}

				return articles;
			}

			async function addEmbeddings(articles, apiKey) {
				let start = 0;
				while (start < articles.length) {
					await Promise.all(articles.slice(start, start + 32).map(async article => {
						article.embedding = await getEmbedding(article.body, apiKey);
					}));
					start += 32;
				}
			}

			async function getEmbedding(content, apiKey) {
				const response = await fetch('https://api.openai.com/v1/embeddings', {
					method: 'POST',
					mode: 'cors',
					headers: {
						'Content-Type': 'application/json',
						Authorization: `Bearer ${apiKey}`
					},
					body: JSON.stringify({
						'input': content,
						'model': 'text-embedding-3-large'
					})
				});
				const json = await response.json();
				return json.data[0].embedding.slice();
			}

			function cosinusDistance(vecA, vecB) {
				const normA = Math.sqrt(vecA.reduce((acc, val) => acc + val ** 2, 0));
				const normB = Math.sqrt(vecB.reduce((acc, val) => acc + val ** 2, 0));
				const AdotB = vecA.reduce((acc, val, index) => acc + val * vecB[index], 0);
				return 1 - AdotB / (normA * normB);
			}

			async function askQuestion() {
				if (answerRunning) {
					return;
				}

				try {
					answerRunning = true;

					// const articles = await decompressData(localStorage.getItem("articles"));
					const articles = articleCache.map(article => ({ ...article }));

					document.getElementById('question').classList.remove('regular');
					document.getElementById('question').classList.add('loading');

					document.querySelector('.answer').style.display = 'none';
					document.querySelectorAll('.article-preview').forEach(element => {
					    element.remove();
					});

					const question = document.querySelector('.question input').value;
					const apiKey = document.getElementById('openAIAPIKey').value;

					// const hallucinatedResponse = await fetch("https://api.openai.com/v1/completions", {
					// 	method: "POST",
					// 	headers: {
					// 		'Content-Type': "application/json",
					// 		Authorization: `Bearer ${apiKey}`,
					// 	},
					// 	body: JSON.stringify({
					// 		model: "gpt-3.5-turbo-instruct",
					// 		temperature: 1.2,
					// 		max_tokens: 2048,
					// 		prompt: question
					// 	}),
					// });
					//
					// let hallucinatedAnswer = '';
					// if (hallucinatedResponse.ok) {
					// 	const data = await hallucinatedResponse.json();
					// 	hallucinatedAnswer = data.choices[0].text;
					// }
					//
					// const embedding = await getEmbedding(`${question}\n\n${hallucinatedAnswer}`, apiKey);
					const embedding = await getEmbedding(question, apiKey);

					articles.forEach(article => article.distance = cosinusDistance(article.embedding, embedding));
					articles.sort((articleA, articleB) => articleA.distance - articleB.distance);
					const relevantArticles = []
					while (relevantArticles.length < 3 && articles.length) {
						const article = articles.shift();
						if (!relevantArticles.some(relevantArticle => relevantArticle.id === article.id)) {
							relevantArticles.push(article);
						}
					}

					// noinspection ES6MissingAwait
					relevantArticles.forEach(async article => {
						const el = document.createElement('div');
						el.className = 'block source article-preview';
						el.innerHTML = `<div><div><a target="_blank" href="${article.url}"><div class="title">${article.title}</div></a></div>`;
						document.querySelector('.answer').insertAdjacentElement('afterend', el);

						const sourceResponse = await fetch("https://api.openai.com/v1/chat/completions", {
							method: "POST",
							headers: {
								'Content-Type': "application/json",
								Authorization: `Bearer ${apiKey}`,
							},
							body: JSON.stringify({
								model: "gpt-4o-mini",
								temperature: 0,
								max_tokens: 2048,
								messages: [{
									role: "user",
									content: [{
										type: "text",
										text: `Schreib eine maximal 300 Zeichen Zusammenfassung des Artikels in Bezug auf die folgende Frage. Schreibe die Zusammenfassung in direkter Rede.\n """${question}""\n\nArtikel:\n ${article.body}`
									}]
								}]
							}),
						});

						if (sourceResponse.ok) {
							const data = await sourceResponse.json();
							el.firstChild.firstChild.firstChild.innerHTML += `<div class="summary">${data.choices[0].message.content}<div>`;
						}
					});

					const messages = [{
						'role': 'system',
						'content': 'Du beantwortest Fragen über die Vereinssoftware Webling wertschätzend, ausfühlich und in Du-Form.\n' +
							'Zum Beantworten der Fragen darfst du nur Informationen aus den Prompt verwenden.\n' +
							'Falls du die Frage nicht ausschliesslich mit den Infromationen aus dem Prompt beantworten kannst, antwort mit "Ich weiss es nicht."\n' +
							'Du bist ein Supportmitarbeiter von Webling. Du Beantfortest fragen abschliessend.'
					}];
					let userPrompt = `Beantworte die Frage ausschliesslich mit den Informationen aus dem Prompt.\n """${question}""\n\n` +
						'Dokumentation der Vereinssoftware Webling:'
					articles.slice(0, 3).forEach(article => {
						userPrompt += `${article.title}\n\n${article.body}\n`
					});
					messages.push({ 'role': 'user', 'content': userPrompt })

					const answerResponse = await fetch("https://api.openai.com/v1/chat/completions", {
						method: "POST",
						headers: {
							'Content-Type': "application/json",
							Authorization: `Bearer ${apiKey}`,
						},
						body: JSON.stringify({
							model: "gpt-4o",
							temperature: 0,
							stream: true,
							messages
						}),
					});

					const reader = answerResponse.body.pipeThrough(new TextDecoderStream()).getReader();

					let answer = '';
					document.querySelector('.answer').style.display = 'block';
					while (true) {
						const { value, done } = await reader.read();
						if (done) break;
						value.split('\n').forEach(line => {
							if (line.startsWith('data:') && line !== 'data: [DONE]') {
								try {
									const data = JSON.parse(line.substring(5).trim());
									const delta = data.choices[0].delta.content;
									if (delta) {
										answer += data.choices[0].delta.content;
										document.querySelector('.answer .content').innerHTML = answer;
									}
								} catch (error) {
									console.error(error, line);
								}
							}
						});
					}
				} finally {
					answerRunning = false;
					document.getElementById('question').classList.add('regular');
					document.getElementById('question').classList.remove('loading');
				}
			}

			async function onDOMContentLoaded() {
				document.removeEventListener('DOMContentLoaded', onDOMContentLoaded);
				document.getElementById('scrape').addEventListener('click', scrapeDoc);
				document.querySelector('.question .icon').addEventListener('click', askQuestion);
				document.getElementById('search').addEventListener('keydown', event => {
				    if (event.key === 'Enter') {
				        askQuestion();
				    }
				});

				if (sessionStorage.getItem("openAIAPIKey")) {
					document.getElementById('openAIAPIKey').value = sessionStorage.getItem("openAIAPIKey");
				}
				if (sessionStorage.getItem("zendeskArticleUri")) {
					document.getElementById('zendeskArticleUri').value = sessionStorage.getItem("zendeskArticleUri");
				}

				let articles = await loadArticles()
				if (articles.length) {
					articleCache = articles
					document.getElementById('settings').style.display = 'none';
					document.getElementById('question').style.visibility = 'visible';
				} else {
					document.getElementById('settings').style.visibility = 'visible';
				}
			}
			document.addEventListener('DOMContentLoaded', onDOMContentLoaded);
		</script>
	</head>
	<body>
		<div class="content">
			<div id="settings" class="block settings regular" style="visibility: hidden">
				<div>
					<div>
						<div>
							<label for="openAIAPIKey">OpenApiKey</label>
							<input id="openAIAPIKey">
						</div>
						<div>
							<label for="zendeskArticleUri">Zendesk Helpcenter API</label>
							<input id="zendeskArticleUri">
						</div>
						<div>
							<button id="scrape">Scrape</button>
						</div>
					</div>
				</div>
			</div>
			<div id="question" class="block question regular" style="visibility: hidden">
				<div>
					<input id="search" autocomplete="off" inputmode="search" placeholder="Wie gebe ich einem Benutzer nur Rechte auf die Buchhaltung?" type="search">
					<svg class="icon" viewBox="0 0 24 24">
						<path style="fill: rgb(194 140 185)" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
					</svg>
				</div>
			</div>
			<div class="block answer" style="display: none">
				<div>
					<div class="content"></div>
				</div>
			</div>
		</div>
	</body>
</html>
